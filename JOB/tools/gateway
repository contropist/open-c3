#!/data/Software/mydan/perl/bin/perl
use strict;
use warnings;
use FindBin qw( $RealBin );
use YAML::XS;
use MYDan;

=head1 SYNOPSIS

 $0

=cut

my $base = $RealBin;
$base =~ s#/[^/]+$##;

print "start gateway\n";

my $supervisor = "$RealBin/../bin/supervisor --name job_openc3_gateway_supervisor";

my $pid = `ps -ef|grep [j]ob_openc3_gateway_supervisor|head -n 1|awk '{print \$2}'`;

exit if $pid =~ /\d+/;

map{
    die "start $_ fail: $!" if system "$supervisor --cmd '$base/server/$_' --log '$base/logs/server/$_'";
}qw( gateway );
