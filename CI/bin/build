#!/data/Software/mydan/perl/bin/perl -I/data/Software/mydan/CI/lib -I/data/Software/mydan/CI/private/lib
use strict;
use warnings;
use MYDB;
use FindBin qw( $RealBin );

use Code;
use MYDan::Util::OptConf;

=head1 SYNOPSIS

 $0 [--uuid uuid] 

=cut

binmode STDIN, ':utf8';
binmode STDOUT, ':utf8';
binmode STDERR, ':utf8';

my $option = MYDan::Util::OptConf->load();
my %o = $option->get( qw( uuid=s ) )->dump();
$option->assert( 'uuid' );

system "killall ci_worker_build_$o{uuid} 2>/dev/null";
$0 = "ci_worker_build_$o{uuid}";

my $db = MYDB->new( "$RealBin/../conf/conn" );

$ENV{PATH} = "$ENV{PATH}:/data/Software/mydan/AGENT/pp:/data/Software/mydan/JOB/pp:/data/Software/mydan/JOBX/pp:/data/Software/mydan/Connector/pp";

Code->new( 'build' )->run( db => $db, %o );
